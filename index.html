<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á”áŸ’ášá–áŸá“áŸ’á’á›á€áŸ‹á‘áŸ†á“á·á‰ (POS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f3f4f6; font-family: 'Kantumruy Pro', sans-serif; }
        .img-preview { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-32">

    <header class="bg-blue-700 text-white p-4 sticky top-0 z-10 shadow-lg">
        <h1 class="text-xl font-bold mb-3 text-center">á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á€á¶ášá›á€áŸ‹</h1>
        <input type="text" id="searchInput" onkeyup="filterProducts()" 
               placeholder="ğŸ” áŸáŸ’áœáŸ‚á„ášá€áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰..." 
               class="w-full p-3 rounded-xl text-black outline-none focus:ring-2 focus:ring-yellow-400">
    </header>

    <section class="p-4 bg-white border-b shadow-sm">
        <h2 class="text-sm font-bold text-blue-600 mb-3 underline">á”á“áŸ’ááŸ‚á˜á‘áŸ†á“á·á‰ááŸ’á˜á¸</h2>
        <div class="space-y-3">
            <input type="text" id="newName" placeholder="áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰" class="w-full border p-2 rounded-lg">
            <div class="flex gap-2">
                <input type="number" id="newPrice" placeholder="áá˜áŸ’á›áŸƒ ($)" class="flex-1 border p-2 rounded-lg">
                <label class="bg-gray-100 border p-2 rounded-lg cursor-pointer text-sm flex items-center">
                    ğŸ“· ášá¼á”á—á¶á–
                    <input type="file" id="newImage" accept="image/*" class="hidden" onchange="previewImage(this)">
                </label>
            </div>
            <div id="imgPreviewArea" class="hidden text-xs text-green-600 italic">âœ“ á”á¶á“á‡áŸ’ášá¾áŸášá¾áŸášá¼á”á—á¶á–</div>
            <button onclick="addProduct()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-800 transition">
                á”á‰áŸ’á…á¼á›á€áŸ’á“á»á„á”á‰áŸ’á‡á¸
            </button>
        </div>
    </section>

    <main class="p-4" id="productList">
        </main>

    <footer class="fixed bottom-0 w-full max-w-md bg-white border-t p-4 flex justify-between items-center shadow-[0_-4px_10px_rgba(0,0,0,0.1)]">
        <div>
            <p class="text-gray-500 text-sm">á…áŸ†á“á½á“: <span id="itemCount" class="font-bold">0</span></p>
            <p class="text-2xl font-bold text-red-600">$<span id="totalPrice">0.00</span></p>
        </div>
        <button class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-md active:scale-95 transition">
            á‘á¼á‘á¶ááŸ‹á”áŸ’ášá¶á€áŸ‹
        </button>
    </footer>

    <script>
        let products = JSON.parse(localStorage.getItem('kh_pos_products')) || [];
        let currentBase64Image = "";

        // Function to convert image to Base64
        function previewImage(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onloadend = function() {
                currentBase64Image = reader.result;
                document.getElementById('imgPreviewArea').classList.remove('hidden');
            }
            if (file) { reader.readAsDataURL(file); }
        }

        function renderProducts(data = products) {
            const list = document.getElementById('productList');
            list.innerHTML = '';
            
            data.forEach(product => {
                const div = document.createElement('div');
                div.className = "bg-white p-3 rounded-xl shadow-sm mb-3 flex items-center border border-gray-100";
                div.innerHTML = `
                    <img src="${product.image || 'https://via.placeholder.com/60'}" class="img-preview mr-3">
                    <div class="flex-1">
                        <h3 class="font-bold text-gray-800">${product.name}</h3>
                        <p class="text-blue-600 font-bold">$${product.price.toFixed(2)}</p>
                    </div>
                    <div class="flex flex-col gap-2">
                        <button onclick="addToCart(${product.price})" class="bg-blue-50 text-blue-600 px-3 py-1 rounded-lg font-bold border border-blue-200">á‘á·á‰</button>
                        <button onclick="deleteProduct(${product.id})" class="text-red-400 text-xs text-center">á›á»á”</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function addProduct() {
            const name = document.getElementById('newName').value;
            const price = parseFloat(document.getElementById('newPrice').value);

            if (name && price) {
                const newProd = { 
                    id: Date.now(), 
                    name: name, 
                    price: price, 
                    image: currentBase64Image 
                };
                products.push(newProd);
                saveAndRender();
                
                // Reset fields
                document.getElementById('newName').value = '';
                document.getElementById('newPrice').value = '';
                document.getElementById('newImage').value = '';
                document.getElementById('imgPreviewArea').classList.add('hidden');
                currentBase64Image = "";
            } else {
                alert("áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡ á“á·á„áá˜áŸ’á›áŸƒá‘áŸ†á“á·á‰!");
            }
        }

        function filterProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => p.name.toLowerCase().includes(query));
            renderProducts(filtered);
        }

        function deleteProduct(id) {
            if(confirm("áá¾á¢áŸ’á“á€á”áŸ’ášá¶á€áŠáá¶á…á„áŸ‹á›á»á”á¬?")) {
                products = products.filter(p => p.id !== id);
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('kh_pos_products', JSON.stringify(products));
            renderProducts();
        }

        let total = 0;
        let count = 0;
        function addToCart(price) {
            total += price;
            count++;
            document.getElementById('totalPrice').innerText = total.toFixed(2);
            document.getElementById('itemCount').innerText = count;
        }

        renderProducts();
    </script>
</body>
</html>
